language: python
# The following two lines force deploy on the latest Trusty Tapir build platforms
sudo: required
dist: trusty
cache:
  apt: true
notifications:
  email: false

# Borrowing schema from https://github.com/pydata/xarray/
matrix:
  include:
#  - python: 2.7
#    env: CONDA_ENV=py27
  - python: 3.4
    env: CONDA_ENV=py34
#  - python: 3.5
#    env: CONDA_ENV=py35

# Packages to install into test linux environment
addons:
  apt:
    packages:
    - cmake
    - liblapack-dev
    - libsundials-serial-dev
    - gfortran

# command to install dependencies (adapted from jakevdp/supersmoother)
# using miniconda
before_install:
    # - sudo apt-get update
    - if [[ "$TRAVIS_PYTHON_VERSION" == "2.7" ]]; then
        wget https://repo.continuum.io/miniconda/Miniconda-latest-Linux-x86_64.sh -O
       miniconda.sh;
      else
        wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O
       miniconda.sh;
      fi
    - bash miniconda.sh -b -p $HOME/miniconda
    - export PATH=$HOME/miniconda/bin:$PATH
    - hash -r
    - conda config --set always_yes yes --set changeps1 no
    - conda update -q conda
    # For debugging conda
    - conda info -a

install:
    # Assimulo testing, for debug purposes
    - conda install -c https://conda.binstar.org/chria assimulo
#    - conda install numpy scipy cython matplotlib
#    - pip install -v assimulo
#    - cd $HOME/miniconda/lib/python${CONDA_ENV/py/}/site-packages/assimulo/
#    - nosetests -v
#    - cd -
    # testing over
    - conda env create --file ci/requirements-$CONDA_ENV.yml
    - source activate parcel_model
    - pip install -e .

script:
    # Automated testng will go here
    - echo "Executing test simulation, 'simple'"
    - ./run_parcel examples/simple.yml
    - echo "Simple test executed sucessfully."